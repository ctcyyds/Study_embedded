C51 COMPILER V9.60.7.0   NTC                                                               04/13/2023 20:46:37 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE NTC
OBJECT MODULE PLACED IN .\Objects\NTC.obj
COMPILER INVOKED BY: D:\instal\Keil_v5\C51\BIN\C51.EXE NTC.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\NTC.lst) TABS(2) OBJECT(.\Objects\NTC.obj)

line level    source

   1          #include "NTC.h"
   2          
   3          
   4          u16 code temp_table[]= {
   5              58354, // -55
   6              55464, // -54
   7              52698, // -53
   8              50048, // -52
   9              47515, // -51
  10              45097, // -50
  11              42789, // -49
  12              40589, // -48
  13              38492, // -47
  14              36496, // -46
  15              34597, // -45
  16              32791, // -44
  17              31075, // -43
  18              29444, // -42
  19              27896, // -41
  20              26427, // -40
  21              25034, // -39
  22              23713, // -38
  23              22460, // -37
  24              21273, // -36
  25              20148, // -35
  26              19083, // -34
  27              18075, // -33
  28              17120, // -32
  29              16216, // -31
  30              15361, // -30
  31              14551, // -29
  32              13785, // -28
  33              13061, // -27
  34              12376, // -26
  35              11728, // -25
  36              11114, // -24
  37              10535, // -23
  38              9986,  // -22
  39              9468,  // -21
  40              8977,  // -20
  41              8513,  // -19
  42              8075,  // -18
  43              7660,  // -17
  44              7267,  // -16
  45              6896,  // -15
  46              6545,  // -14
  47              6212,  // -13
  48              5898,  // -12
  49              5601,  // -11
  50              5319,  // -10
  51              5053,  // -9
  52              4801,  // -8
  53              4562,  // -7
  54              4336,  // -6
C51 COMPILER V9.60.7.0   NTC                                                               04/13/2023 20:46:37 PAGE 2   

  55              4122,  // -5
  56              3920,  // -4
  57              3728,  // -3
  58              3546,  // -2
  59              3374,  // -1
  60              3211,  // 0
  61              3057,  // 1
  62              2910,  // 2
  63              2771,  // 3
  64              2639,  // 4
  65              2515,  // 5
  66              2396,  // 6
  67              2284,  // 7
  68              2177,  // 8
  69              2076,  // 9
  70              1978,  // 10
  71              1889,  // 11
  72              1802,  // 12
  73              1720,  // 13
  74              1642,  // 14
  75              1568,  // 15
  76              1497,  // 16
  77              1430,  // 17
  78              1366,  // 18
  79              1306,  // 19
  80              1248,  // 20
  81              1193,  // 21
  82              1141,  // 22
  83              1092,  // 23
  84              1044,  // 24
  85              1000,  // 25
  86              957,   // 26
  87              916,   // 27
  88              877,   // 28
  89              840,   // 29
  90              805,   // 30
  91              771,   // 31
  92              739,   // 32
  93              709,   // 33
  94              679,   // 34
  95              652,   // 35
  96              625,   // 36
  97              600,   // 37
  98              576,   // 38
  99              552,   // 39
 100              530,   // 40
 101              509,   // 41
 102              489,   // 42
 103              470,   // 43
 104              452,   // 44
 105              434,   // 45
 106              417,   // 46
 107              401,   // 47
 108              386,   // 48
 109              371,   // 49
 110              358,   // 50
 111              344,   // 51
 112              331,   // 52
 113              318,   // 53
 114              306,   // 54
 115              295,   // 55
 116              284,   // 56
C51 COMPILER V9.60.7.0   NTC                                                               04/13/2023 20:46:37 PAGE 3   

 117              274,   // 57
 118              264,   // 58
 119              254,   // 59
 120              245,   // 60
 121              236,   // 61
 122              228,   // 62
 123              220,   // 63
 124              212,   // 64
 125              205,   // 65
 126              198,   // 66
 127              191,   // 67
 128              184,   // 68
 129              178,   // 69
 130              172,   // 70
 131              166,   // 71
 132              160,   // 72
 133              155,   // 73
 134              150,   // 74
 135              145,   // 75
 136              140,   // 76
 137              135,   // 77
 138              131,   // 78
 139              126,   // 79
 140              122,   // 80
 141              118,   // 81
 142              115,   // 82
 143              111,   // 83
 144              107,   // 84
 145              104,   // 85
 146              101,   // 86
 147              97,    // 87
 148              94,    // 88
 149              91,    // 89
 150              89,    // 90
 151              86,    // 91
 152              83,    // 92
 153              81,    // 93
 154              78,    // 94
 155              76,    // 95
 156              74,    // 96
 157              71,    // 97
 158              69,    // 98
 159              67,    // 99
 160              65,    // 100
 161              63,    // 101
 162              61,    // 102
 163              60,    // 103
 164              58,    // 104
 165              56,    // 105
 166              55,    // 106
 167              53,    // 107
 168              52,    // 108
 169              50,    // 109
 170              49,    // 110
 171              47,    // 111
 172              46,    // 112
 173              45,    // 113
 174              43,    // 114
 175              42,    // 115
 176              41,    // 116
 177              40,    // 117
 178              39,    // 118
C51 COMPILER V9.60.7.0   NTC                                                               04/13/2023 20:46:37 PAGE 4   

 179              38,    // 119
 180              37,    // 120
 181              36,    // 121
 182              35,    // 122
 183              34,    // 123
 184              33,    // 124
 185              32,    // 125
 186          };
 187          /***************不同芯片更改处********************/
 188          u16 NTC_Get_ADCResult(u8 chn){
 189   1        return Get_ADCResult(chn);
 190   1      }
 191          /************************************************/
 192          
 193          //查找函数
 194          static int search(float r) {
 195   1          //数组遍历
 196   1          //返回下标
 197   1          int i, minIdx;
 198   1          float min = temp_table[0] > r ? temp_table[0] - r : r - temp_table[0];
 199   1          minIdx = 0;
 200   1          for(i=0; i < sizeof(temp_table) / sizeof(u16); i++) {
 201   2              //通过r和每一个进行比对，找到相近的值
 202   2              if(min > (temp_table[i] > r ? temp_table[i] - r : r - temp_table[i])) {
 203   3                  min = temp_table[i] > r ? temp_table[i] - r : r - temp_table[i];
 204   3                  minIdx = i;
 205   3              }
 206   2          }
 207   1          return minIdx;
 208   1      }
 209          
 210          void NTC_init(){
 211   1       NTC_PIN_INIT();
 212   1      }
 213          
 214          
 215          int NTC_get_temperature() {
 216   1          u16 result;
 217   1          float v;//定义电压值
 218   1          float r;//热敏电阻阻值
 219   1          int t;//温度
 220   1      
 221   1          //channel是通道,可在.h文件中查找
 222   1          //引用.h文件中的ADC函数
 223   1          result = NTC_Get_ADCResult(NTC_CHN);
 224   1      
 225   1          //转换成具体的电压值,基准电压以数据手册为准
 226   1          //电压值=采样值x基准电压/基准值
 227   1          v = (result * 2.5)/4096;
 228   1      
 229   1          //热敏电阻阻值=热敏电阻电压 x 10K / （VCC-热敏电阻电压）
 230   1          r = v * 10 / (3.3 - v) * 100;//因为要放大，所以后面乘以100
 231   1      
 232   1          //将阻值转换为温度
 233   1          //通过阻值查表，找到下标，下标-55就是温度
 234   1          t = search(r) - 55;
 235   1          return t;
 236   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    541    ----
C51 COMPILER V9.60.7.0   NTC                                                               04/13/2023 20:46:37 PAGE 5   

   CONSTANT SIZE    =    362    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      16
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
